plugins {
	id 'com.gradleup.shadow' version '8.3.5'
	id 'application'
}

repositories {
	mavenLocal()
	mavenCentral()
}

dependencies {
	implementation project(':client')
	implementation project(':client.diff')
	implementation project(':gen.antlr3')
	implementation project(':gen.antlr3-antlr')
	implementation project(':gen.antlr3-json')
	implementation project(':gen.antlr3-php')
	implementation project(':gen.antlr3-r')
	implementation project(':gen.antlr3-xml')
	implementation project(':gen.c')
	implementation project(':gen.css')
	implementation project(':gen.javaparser')
	implementation project(':gen.jdt')
	implementation project(':gen.js')
	implementation project(':gen.js-acorn')
	implementation project(':gen.python')
	implementation project(':gen.ruby')
	implementation project(':gen.srcml')
	implementation project(':gen.treesitter')
	implementation project(':gen.treesitter-ng')
	implementation project(':gen.xml')
	implementation project(':gen.yaml')
}

description = 'GumTree distribution.'

shadowJar {
	archiveBaseName.set('gumtree')
	archiveClassifier.set('')
	archiveVersion.set('')
	mergeServiceFiles()
	mergeServiceFiles {
		path = 'META-INF/annotations'
	}
}

distributions {
	shadow {
		distributionBaseName = 'gumtree'
	}
}

application {
	mainClass = 'com.github.gumtreediff.client.Run'
	applicationName = 'gumtree'
}

tasks.named('shadowJar', com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {
	archiveBaseName.set('gumtree')
}

shadowDistZip.enabled = true
distTar.enabled = false
distZip.enabled = false
startScripts.enabled = false
shadowDistTar.enabled = false

jar.enabled = false

build.finalizedBy installShadowDist